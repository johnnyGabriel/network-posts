$(function(){{var PostModel=Backbone.Model.extend({defaults:{user:{id:1,username:"Visitante",avatar:"assets/images/avatar.png"},date:"",content:"",likes:"",share:""},toTemplate:function(){var j=this.toJSON();return j.timeSincePost=this.timeSincePost(),j},timeSincePost:function(){for(var measure=[[1e3,"segundo"],[60,"minuto"],[60,"hora"],[24,"dia"],[7,"semana"],[4,"mese"],[12,"ano"]],passedTime=Date.now()-Date.parse(this.get("date")),temp=passedTime,i=0;i<measure.length&&(temp/=measure[i][0])>1;)passedTime=temp,i++;return 0===i?"agora mesmo":parseInt(passedTime)+" "+(1===parseInt(passedTime)?measure[i-1][1]:measure[i-1][1]+"s")+" atrás"},like:function(){this.set({likes:this.get("likes")+1})},share:function(){this.set({share:this.get("share")+1})}}),PostCollection=Backbone.Collection.extend({model:PostModel,initialize:function(){this.readLocal()},saveLocal:function(){localStorage.setItem("posts",JSON.stringify(this.models))},readLocal:function(){var postsLocal=localStorage.getItem("posts");this.add(postsLocal?JSON.parse(postsLocal):{user:{id:0,username:"Johnny Pestana",avatar:"assets/images/johnny-avatar.jpg"},date:"2015-07-22T19:34:22.720Z",content:"Olá, seja bem-vindo!",likes:10,share:2})}}),PostView=Backbone.View.extend({tagName:"div",className:"post-container",template:$("#post-view-template").html(),events:{"click .post-delete":"deletePost","click .post-like":"likePost","click .post-share":"sharePost"},render:function(){var html=Mustache.to_html(this.template,this.model.toTemplate());return this.$el.html(html),this},removePost:function(){this.$el.slideUp("normal",function(){this.remove()})},deletePost:function(){this.model.unset("user")},likePost:function(){this.model.like()},sharePost:function(){this.model.share()}}),PostInsertView=Backbone.View.extend({template:$("#insert-post-template").html(),events:{"keyup #postContent":"enablePostButton",submit:"insertPost"},initialize:function(){this.render()},render:function(){var html=Mustache.to_html(this.template,this.model.toJSON());return this.$el.html(html),this.inputContent=this.$el.find("#postContent"),this.submitButton=this.$el.find("input[type='submit']"),this},enablePostButton:function(){this.inputContent.val().length>0?this.submitButton.prop("disabled",!1):this.submitButton.prop("disabled",!0)},insertPost:function(e){e.preventDefault(),this.model.set({date:new Date,content:this.inputContent.val(),likes:0,share:0}),this.render()}}),AppView=Backbone.View.extend({el:".container",initialize:function(){_.bindAll(this,"showPost","showAllPosts"),this.elFormInsert=this.$el.find("#form-insert-post"),this.elPosts=this.$el.find("#container-posts"),this.newPostModel=new PostModel,this.newPostModel.on("change",function(model){this.postCollection.add(model.clone())},this);var postInsert=new PostInsertView({model:this.newPostModel});this.elFormInsert.append(postInsert.render().el),this.postCollection=new PostCollection,this.postCollection.on("update",function(){this.postCollection.saveLocal()},this),this.postCollection.on("add",function(model){this.showPost(model)},this),this.showAllPosts()},showPost:function(post){var postView=new PostView({model:post});post.on("change:user",function(model){postView.removePost(),this.postCollection.remove(model)},this),post.on("change:likes",function(){postView.render(),this.postCollection.saveLocal()},this),post.on("change:share",function(){postView.render(),this.postCollection.saveLocal()},this),this.elPosts.prepend(postView.render().el),postView.$el.slideDown("normal"),setInterval(function(){postView.render()},6e4)},showAllPosts:function(){this.elPosts.html(""),this.postCollection.each(this.showPost)}});new AppView}});
//# sourceMappingURL=main.min.map